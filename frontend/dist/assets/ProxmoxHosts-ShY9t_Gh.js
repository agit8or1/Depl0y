import{_ as L,c as l,o as a,a as s,d as P,F as H,p as A,t as d,m as C,w as N,e as m,v as u,b as g,E as M,x as W,r as c,j as E,k as j,l as f}from"./index-DpP9cWht.js";const R={name:"ProxmoxHosts",setup(){const x=W(),t=c([]),b=c([]),o=c(!1),y=c(!1),_=c(!1),e=c(!1),r=c(!1),h=c({name:"",hostname:"",port:8006,username:"root@pam",password:"",api_token_id:"",api_token_secret:"",verify_ssl:!1}),k=async()=>{o.value=!0;try{const n=await f.proxmox.listHosts();t.value=n.data}catch(n){console.error("Failed to fetch hosts:",n)}finally{o.value=!1}},T=async()=>{_.value=!0;try{const n={...h.value};r.value?delete n.password:(delete n.api_token_id,delete n.api_token_secret),await f.proxmox.createHost(n),x.success("Proxmox host added successfully"),e.value=!1,r.value=!1,h.value={name:"",hostname:"",port:8006,username:"root@pam",password:"",api_token_id:"",api_token_secret:"",verify_ssl:!1},await k()}catch(n){console.error("Failed to add host:",n)}finally{_.value=!1}},U=async n=>{try{const i=await f.proxmox.testConnection(n);i.data.status==="success"?x.success("Connection successful!"):x.error("Connection failed: "+i.data.message)}catch(i){console.error("Failed to test connection:",i)}},D=async n=>{try{await f.proxmox.pollHost(n),x.success("Polling started"),setTimeout(()=>{k(),w()},2e3)}catch(i){console.error("Failed to poll host:",i)}},w=async()=>{y.value=!0;try{const n=t.value.map(p=>f.proxmox.listNodes(p.id).catch(v=>(console.error(`Failed to fetch nodes for ${p.name}:`,v),{data:[]}))),i=await Promise.all(n);b.value=i.flatMap((p,v)=>p.data.map(q=>({...q,host_id:t.value[v].id})))}catch(n){console.error("Failed to refresh nodes:",n)}finally{y.value=!1}},V=E(()=>t.value.map(n=>({...n,nodes:b.value.filter(i=>i.host_id===n.id)}))),F=n=>{if(!n)return"N/A";const i=Math.floor(n/86400),p=Math.floor(n%86400/3600),v=Math.floor(n%3600/60);return`${i}d ${p}h ${v}m`},B=async n=>{if(confirm("Are you sure you want to delete this Proxmox host?"))try{await f.proxmox.deleteHost(n),x.success("Host deleted"),await k()}catch(i){console.error("Failed to delete host:",i)}},I=n=>new Date(n).toLocaleString(),S=n=>n?(n/(1024*1024*1024)).toFixed(2)+" GB":"0 B";return j(()=>{k().then(()=>{w()})}),{hosts:t,allNodes:b,loading:o,loadingNodes:y,saving:_,showAddModal:e,useApiToken:r,newHost:h,datacentersWithNodes:V,addHost:T,testConnection:U,pollHost:D,refreshAllNodes:w,deleteHost:B,formatDate:I,formatBytes:S,formatUptime:F}}},z={class:"proxmox-hosts-page"},G={class:"card mb-2"},K={class:"card-header"},O={key:0,class:"loading-spinner"},J={key:1,class:"text-center text-muted"},Q={key:2,class:"table-container"},X={class:"table"},Y={key:0,class:"text-sm"},Z={key:1,class:"text-muted text-sm"},$={class:"flex gap-1"},ss=["onClick"],ts=["onClick"],os=["onClick"],es={class:"card"},ns={class:"card-header"},ls={key:0},as={key:1},rs={key:0,class:"loading-spinner"},ds={key:1,class:"text-center text-muted"},is={key:2,class:"nodes-section"},ms={class:"datacenter-title"},cs={key:0,class:"text-muted text-sm"},us={key:1,class:"nodes-grid"},xs={class:"node-header"},ps={class:"node-stats"},fs={class:"stat"},vs={class:"stat-value"},bs={class:"stat"},ys={class:"stat-value"},_s={class:"stat"},ks={class:"stat-value"},gs={class:"stat"},hs={class:"stat-value"},ws={class:"modal-header"},Hs={class:"form-group"},As={class:"form-group"},Ps={class:"form-group"},Cs={class:"form-group"},Ns={class:"auth-section"},Ms={class:"form-group"},Ts={class:"form-label"},Us={key:0,class:"warning-box"},Ds={key:1},Vs={class:"form-group"},Fs=["required"],Bs={key:2},Is={class:"form-group"},Ss=["required"],qs={class:"form-group"},Ls=["required"],Ws={class:"form-group"},Es={class:"form-label"},js={class:"flex gap-1 mt-2"},Rs=["disabled"];function zs(x,t,b,o,y,_){return a(),l("div",z,[t[40]||(t[40]=s("div",{class:"page-header mb-2"},[s("h2",null,"Proxmox Datacenters and Hosts"),s("p",{class:"text-muted"},"Manage your Proxmox clusters and hypervisor nodes")],-1)),s("div",G,[s("div",K,[t[16]||(t[16]=s("h3",null,"Datacenters",-1)),s("button",{onClick:t[0]||(t[0]=e=>o.showAddModal=!0),class:"btn btn-primary"},"+ Add Datacenter")]),o.loading?(a(),l("div",O)):o.hosts.length===0?(a(),l("div",J,[...t[17]||(t[17]=[s("p",null,"No Proxmox datacenters configured yet.",-1),s("p",{class:"text-sm"},"Add a datacenter to start deploying VMs.",-1)])])):(a(),l("div",Q,[s("table",X,[t[18]||(t[18]=s("thead",null,[s("tr",null,[s("th",null,"Datacenter Name"),s("th",null,"Hostname"),s("th",null,"Username"),s("th",null,"Status"),s("th",null,"Last Poll"),s("th",null,"Actions")])],-1)),s("tbody",null,[(a(!0),l(H,null,A(o.hosts,e=>(a(),l("tr",{key:e.id},[s("td",null,d(e.name),1),s("td",null,d(e.hostname)+":"+d(e.port),1),s("td",null,d(e.username),1),s("td",null,[s("span",{class:C(["badge",e.is_active?"badge-success":"badge-danger"])},d(e.is_active?"Active":"Inactive"),3)]),s("td",null,[e.last_poll?(a(),l("span",Y,d(o.formatDate(e.last_poll)),1)):(a(),l("span",Z,"Never"))]),s("td",null,[s("div",$,[s("button",{onClick:r=>o.testConnection(e.id),class:"btn btn-outline btn-sm"},"Test",8,ss),s("button",{onClick:r=>o.pollHost(e.id),class:"btn btn-outline btn-sm"},"Poll",8,ts),s("button",{onClick:r=>o.deleteHost(e.id),class:"btn btn-danger btn-sm"},"Delete",8,os)])])]))),128))])])]))]),s("div",es,[s("div",ns,[t[19]||(t[19]=s("h3",null,"Cluster Nodes",-1)),s("button",{onClick:t[1]||(t[1]=(...e)=>o.refreshAllNodes&&o.refreshAllNodes(...e)),class:"btn btn-outline"},[o.loadingNodes?(a(),l("span",as,"Loading...")):(a(),l("span",ls,"ðŸ”„ Refresh All"))])]),o.loadingNodes?(a(),l("div",rs)):o.allNodes.length===0?(a(),l("div",ds,[...t[20]||(t[20]=[s("p",null,"No cluster nodes found.",-1),s("p",{class:"text-sm"},"Poll your datacenters to discover nodes.",-1)])])):(a(),l("div",is,[(a(!0),l(H,null,A(o.datacentersWithNodes,e=>(a(),l("div",{key:e.id,class:"datacenter-section"},[s("h4",ms,d(e.name),1),e.nodes.length===0?(a(),l("div",cs,' No nodes discovered yet. Click "Poll" to discover nodes. ')):(a(),l("div",us,[(a(!0),l(H,null,A(e.nodes,r=>(a(),l("div",{key:r.id,class:"node-card"},[s("div",xs,[s("h5",null,d(r.node_name),1),s("span",{class:C(["badge",r.status==="online"?"badge-success":"badge-danger"])},d(r.status||"unknown"),3)]),s("div",ps,[s("div",fs,[t[21]||(t[21]=s("span",{class:"stat-label"},"CPU:",-1)),s("span",vs,d(r.cpu_cores)+" cores ("+d(r.cpu_usage)+"%)",1)]),s("div",bs,[t[22]||(t[22]=s("span",{class:"stat-label"},"Memory:",-1)),s("span",ys,d(o.formatBytes(r.memory_used))+" / "+d(o.formatBytes(r.memory_total)),1)]),s("div",_s,[t[23]||(t[23]=s("span",{class:"stat-label"},"Disk:",-1)),s("span",ks,d(o.formatBytes(r.disk_used))+" / "+d(o.formatBytes(r.disk_total)),1)]),s("div",gs,[t[24]||(t[24]=s("span",{class:"stat-label"},"Uptime:",-1)),s("span",hs,d(o.formatUptime(r.uptime)),1)])])]))),128))]))]))),128))]))]),o.showAddModal?(a(),l("div",{key:0,class:"modal",onClick:t[15]||(t[15]=e=>o.showAddModal=!1)},[s("div",{class:"modal-content",onClick:t[14]||(t[14]=N(()=>{},["stop"]))},[s("div",ws,[t[25]||(t[25]=s("h3",null,"Add Proxmox Datacenter",-1)),s("button",{onClick:t[2]||(t[2]=e=>o.showAddModal=!1),class:"btn-close"},"Ã—")]),s("form",{onSubmit:t[13]||(t[13]=N((...e)=>o.addHost&&o.addHost(...e),["prevent"])),class:"modal-body"},[s("div",Hs,[t[26]||(t[26]=s("label",{class:"form-label"},"Name",-1)),m(s("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>o.newHost.name=e),class:"form-control",required:""},null,512),[[u,o.newHost.name]])]),s("div",As,[t[27]||(t[27]=s("label",{class:"form-label"},"Hostname/IP",-1)),m(s("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>o.newHost.hostname=e),class:"form-control",required:""},null,512),[[u,o.newHost.hostname]])]),s("div",Ps,[t[28]||(t[28]=s("label",{class:"form-label"},"Port",-1)),m(s("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>o.newHost.port=e),type:"number",class:"form-control"},null,512),[[u,o.newHost.port]])]),s("div",Cs,[t[29]||(t[29]=s("label",{class:"form-label"},"Username",-1)),m(s("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>o.newHost.username=e),class:"form-control",required:""},null,512),[[u,o.newHost.username]])]),s("div",Ns,[t[37]||(t[37]=s("h5",{class:"section-subtitle"},"Authentication Method",-1)),t[38]||(t[38]=s("p",{class:"text-sm text-muted"},"Choose one authentication method below:",-1)),s("div",Ms,[s("label",Ts,[m(s("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>o.useApiToken=e),type:"checkbox"},null,512),[[M,o.useApiToken]]),t[30]||(t[30]=g(" Use API Token (recommended for 2FA-enabled Proxmox) ",-1))])]),o.useApiToken?(a(),l("div",Us,[...t[31]||(t[31]=[s("strong",null,"âš ï¸ IMPORTANT: Privilege Separation",-1),s("p",null,[g("When creating your API token in Proxmox, you MUST "),s("strong",null,"UNCHECK"),g(' the "Privilege Separation" option.')],-1),s("p",{class:"text-xs"},"Without this, the token won't have permissions to manage VMs.",-1)])])):P("",!0),o.useApiToken?(a(),l("div",Bs,[s("div",Is,[t[33]||(t[33]=s("label",{class:"form-label"},"API Token ID",-1)),m(s("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>o.newHost.api_token_id=e),class:"form-control",placeholder:"root@pam!mytoken or mytoken",required:o.useApiToken},null,8,Ss),[[u,o.newHost.api_token_id]]),t[34]||(t[34]=s("p",{class:"text-xs text-muted mt-1"},'Full format: "root@pam!mytoken" or just "mytoken"',-1))]),s("div",qs,[t[35]||(t[35]=s("label",{class:"form-label"},"API Token Secret",-1)),m(s("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>o.newHost.api_token_secret=e),type:"password",class:"form-control",placeholder:"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",required:o.useApiToken},null,8,Ls),[[u,o.newHost.api_token_secret]]),t[36]||(t[36]=s("p",{class:"text-xs text-muted mt-1"},"The UUID secret generated by Proxmox",-1))])])):(a(),l("div",Ds,[s("div",Vs,[t[32]||(t[32]=s("label",{class:"form-label"},"Password",-1)),m(s("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>o.newHost.password=e),type:"password",class:"form-control",required:!o.useApiToken},null,8,Fs),[[u,o.newHost.password]])])]))]),s("div",Ws,[s("label",Es,[m(s("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>o.newHost.verify_ssl=e),type:"checkbox"},null,512),[[M,o.newHost.verify_ssl]]),t[39]||(t[39]=g(" Verify SSL Certificate ",-1))])]),s("div",js,[s("button",{type:"submit",class:"btn btn-primary",disabled:o.saving},d(o.saving?"Adding...":"Add Host"),9,Rs),s("button",{type:"button",onClick:t[12]||(t[12]=e=>o.showAddModal=!1),class:"btn btn-outline"}," Cancel ")])],32)])])):P("",!0)])}const Ks=L(R,[["render",zs],["__scopeId","data-v-04139eed"]]);export{Ks as default};
