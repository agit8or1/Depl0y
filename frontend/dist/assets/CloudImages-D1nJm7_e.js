import{_ as Z,c as n,o as d,a as e,d as f,t as i,F as k,p as x,m as q,n as $,e as v,A as L,E as ee,w as N,v as C,B as oe,x as te,r as c,k as se,G as ae,l as g}from"./index-Bi5Eh8tr.js";const le={name:"CloudImages",setup(){const r=te(),o=c([]),T=c([]),s=c(!1),F=c(!1),S=c(!1),t=c(null),u=c(!1),h=c(!1),A=c({}),M=c(!1),U=c(!1);let b=null;const y=c({name:"",filename:"",download_url:"",os_type:"",version:"",architecture:"amd64",checksum:""}),_=c({selectedNodeId:"",selectedImageIds:[]}),R=c([{name:"Ubuntu 24.04 LTS (Noble)",filename:"noble-server-cloudimg-amd64.img",os_type:"ubuntu",version:"24.04",architecture:"amd64",download_url:"https://cloud-images.ubuntu.com/noble/current/noble-server-cloudimg-amd64.img",icon:"ðŸŸ "},{name:"Ubuntu 22.04 LTS (Jammy)",filename:"jammy-server-cloudimg-amd64.img",os_type:"ubuntu",version:"22.04",architecture:"amd64",download_url:"https://cloud-images.ubuntu.com/jammy/current/jammy-server-cloudimg-amd64.img",icon:"ðŸŸ "},{name:"Ubuntu 20.04 LTS (Focal)",filename:"focal-server-cloudimg-amd64.img",os_type:"ubuntu",version:"20.04",architecture:"amd64",download_url:"https://cloud-images.ubuntu.com/focal/current/focal-server-cloudimg-amd64.img",icon:"ðŸŸ "},{name:"Debian 12 (Bookworm)",filename:"debian-12-generic-amd64.qcow2",os_type:"debian",version:"12",architecture:"amd64",download_url:"https://cloud.debian.org/images/cloud/bookworm/latest/debian-12-generic-amd64.qcow2",icon:"ðŸ”´"},{name:"Debian 11 (Bullseye)",filename:"debian-11-generic-amd64.qcow2",os_type:"debian",version:"11",architecture:"amd64",download_url:"https://cloud.debian.org/images/cloud/bullseye/latest/debian-11-generic-amd64.qcow2",icon:"ðŸ”´"},{name:"Rocky Linux 9",filename:"Rocky-9-GenericCloud-Base.latest.x86_64.qcow2",os_type:"rocky",version:"9",architecture:"amd64",download_url:"https://download.rockylinux.org/pub/rocky/9/images/x86_64/Rocky-9-GenericCloud-Base.latest.x86_64.qcow2",icon:"ðŸŸ¢"},{name:"Rocky Linux 8",filename:"Rocky-8-GenericCloud-Base.latest.x86_64.qcow2",os_type:"rocky",version:"8",architecture:"amd64",download_url:"https://download.rockylinux.org/pub/rocky/8/images/x86_64/Rocky-8-GenericCloud-Base.latest.x86_64.qcow2",icon:"ðŸŸ¢"},{name:"AlmaLinux 9",filename:"AlmaLinux-9-GenericCloud-latest.x86_64.qcow2",os_type:"alma",version:"9",architecture:"amd64",download_url:"https://repo.almalinux.org/almalinux/9/cloud/x86_64/images/AlmaLinux-9-GenericCloud-latest.x86_64.qcow2",icon:"ðŸ”µ"},{name:"AlmaLinux 8",filename:"AlmaLinux-8-GenericCloud-latest.x86_64.qcow2",os_type:"alma",version:"8",architecture:"amd64",download_url:"https://repo.almalinux.org/almalinux/8/cloud/x86_64/images/AlmaLinux-8-GenericCloud-latest.x86_64.qcow2",icon:"ðŸ”µ"}]),V=a=>{y.value={name:a.name,filename:a.filename,download_url:a.download_url,os_type:a.os_type,version:a.version,architecture:a.architecture,checksum:""}},w=async()=>{s.value=!0;try{const a=await g.cloudImages.list();o.value=a.data}catch(a){console.error("Failed to fetch cloud images:",a)}finally{s.value=!1}},O=async a=>{try{await g.cloudImages.download(a),r.success("Cloud image download started"),B()}catch(l){console.error("Failed to start download:",l),r.error("Failed to start download")}},G=async()=>{u.value=!0;try{t.value?(await g.cloudImages.update(t.value.id,y.value),r.success("Cloud image updated successfully")):(await g.cloudImages.create(y.value),r.success("Cloud image added successfully")),D(),w()}catch(a){console.error("Failed to save cloud image:",a),r.error("Failed to save cloud image")}finally{u.value=!1}},E=a=>{t.value=a,y.value={name:a.name,filename:a.filename,download_url:a.download_url,os_type:a.os_type,version:a.version||"",architecture:a.architecture,checksum:a.checksum||""},F.value=!0},P=async a=>{if(confirm("Are you sure you want to delete this cloud image?"))try{await g.cloudImages.delete(a),r.success("Cloud image deleted successfully"),w()}catch(l){console.error("Failed to delete cloud image:",l),r.error("Failed to delete cloud image")}},D=()=>{F.value=!1,t.value=null,y.value={name:"",filename:"",download_url:"",os_type:"",version:"",architecture:"amd64",checksum:""}},z=a=>{if(!a)return"0 B";const l=["B","KB","MB","GB","TB"],p=Math.floor(Math.log(a)/Math.log(1024));return Math.round(a/Math.pow(1024,p)*100)/100+" "+l[p]},j=a=>({ubuntu:"Ubuntu",debian:"Debian",centos:"CentOS",rocky:"Rocky Linux",alma:"AlmaLinux",fedora:"Fedora",opensuse:"openSUSE",other:"Other"})[a]||a,H=async()=>{try{const a=await g.proxmox.listHosts(),l=[];for(const p of a.data)try{const m=await g.proxmox.listNodes(p.id);m.data&&m.data.length>0&&m.data.forEach(I=>{l.push({id:I.id,node_name:I.node_name,proxmox_host_name:p.name})})}catch(m){console.error(`Failed to fetch nodes for host ${p.name}:`,m)}T.value=l}catch(a){console.error("Failed to fetch nodes:",a),r.error("Failed to fetch Proxmox nodes")}},J=async()=>{if(!_.value.selectedNodeId||_.value.selectedImageIds.length===0){r.error("Please select a node and at least one cloud image");return}h.value=!0;try{await g.cloudImages.setupTemplates({node_id:parseInt(_.value.selectedNodeId),cloud_image_ids:_.value.selectedImageIds}),r.success("Template setup started! This may take several minutes."),S.value=!1,_.value={selectedNodeId:"",selectedImageIds:[]}}catch(a){console.error("Failed to setup templates:",a),r.error("Failed to start template setup")}finally{h.value=!1}},K=async()=>{S.value=!0,await H()},B=()=>{b||(b=setInterval(()=>{w(),!o.value.some(l=>l.download_status==="downloading")&&b&&(clearInterval(b),b=null)},2e3))},Q=async()=>{M.value=!0,A.value={};try{const a=await g.proxmox.listHosts(),l={};for(const p of a.data)try{const m=await g.proxmox.listNodes(p.id);if(m.data&&m.data.length>0)for(const I of m.data){const Y=await g.cloudImages.checkTemplates(I.id);l[I.id]=Y.data}}catch(m){console.error(`Failed to check templates for host ${p.name}:`,m)}A.value=l,r.success("Template status checked successfully")}catch(a){console.error("Failed to check templates:",a),r.error("Failed to check template status")}finally{M.value=!1}},W=a=>Object.values(a).filter(l=>l).length,X=async()=>{var a;U.value=!0;try{const l=await g.cloudImages.fetchLatest();l.data.updated_count>0?(((a=l.data.updated_images)==null?void 0:a.some(m=>m.status==="added"))?r.success(`Added ${l.data.updated_count} cloud image(s) to database`):r.success(`Updated ${l.data.updated_count} cloud image(s)`),await w()):r.info("All cloud images are up to date"),l.data.errors&&l.data.errors.length>0&&(console.error("Cloud image errors:",l.data.errors),r.warning(`Some images could not be updated: ${l.data.errors.length} errors`))}catch(l){console.error("Failed to fetch latest cloud images:",l),r.error("Failed to fetch latest cloud images")}finally{U.value=!1}};return se(()=>{w(),o.value.some(l=>l.download_status==="downloading")&&B()}),ae(()=>{b&&clearInterval(b)}),{images:o,nodes:T,loading:s,showAddModal:F,showSetupModal:S,editingImage:t,imageForm:y,setupForm:_,saving:u,settingUpTemplates:h,templateStatus:A,checkingTemplates:M,fetchingLatest:U,predefinedImages:R,fetchImages:w,downloadImage:O,saveImage:G,editImage:E,deleteImage:P,closeModal:D,setupTemplates:J,openSetupModal:K,checkAllTemplates:Q,getTemplateCount:W,fetchLatestImages:X,selectPredefinedImage:V,formatBytes:z,formatOSType:j}}},ne={class:"cloud-images-page"},de={class:"card"},ie={class:"card-header"},re={class:"flex gap-1"},ce=["disabled"],me=["disabled"],ue={key:0,class:"template-status-section"},ge={class:"template-status-grid"},pe={class:"node-status-header"},ve={class:"node-name"},fe={class:"template-count"},be={class:"template-list"},he={class:"template-vmid"},ye={key:1,class:"loading-spinner"},_e={key:2,class:"text-center text-muted"},we={key:3,class:"table-container"},ke={class:"table"},xe={class:"badge badge-info"},Ie={key:0,class:"download-progress"},Ce={class:"progress-bar-container"},Fe={class:"text-xs text-muted"},Se={key:1,class:"badge badge-success"},Te={key:2,class:"badge badge-danger"},Ae={key:3,class:"badge badge-secondary"},Me={class:"flex gap-1"},Ue=["onClick"],Le={key:1,class:"btn btn-secondary btn-sm",disabled:""},Ne=["onClick"],De=["onClick"],Be={class:"modal-header"},qe={class:"modal-body"},Re={class:"form-group"},Ve=["value"],Oe={class:"form-group"},Ge={class:"checkbox-list"},Ee=["value"],Pe={key:0,class:"alert alert-info"},ze={class:"modal-footer"},je=["disabled"],He=["disabled"],Je={class:"modal-header"},Ke={key:0,class:"predefined-images-section"},Qe={class:"predefined-images-grid"},We=["onClick"],Xe={class:"predefined-image-icon"},Ye={class:"predefined-image-info"},Ze={class:"predefined-image-name"},$e={class:"predefined-image-details"},eo={key:0,class:"predefined-image-check"},oo={class:"form-group"},to={class:"form-group"},so={class:"form-group"},ao={class:"grid grid-cols-2 gap-2"},lo={class:"form-group"},no={class:"form-group"},io={class:"grid grid-cols-2 gap-2"},ro={class:"form-group"},co={class:"form-group"},mo={class:"modal-footer"},uo=["disabled"];function go(r,o,T,s,F,S){return d(),n("div",ne,[e("div",de,[e("div",ie,[o[23]||(o[23]=e("h3",null,"Cloud Images",-1)),e("div",re,[e("button",{onClick:o[0]||(o[0]=(...t)=>s.fetchLatestImages&&s.fetchLatestImages(...t)),class:"btn btn-outline",disabled:s.fetchingLatest},i(s.fetchingLatest?"ðŸ”„ Updating...":"â¬‡ï¸ Fetch Latest"),9,ce),e("button",{onClick:o[1]||(o[1]=(...t)=>s.checkAllTemplates&&s.checkAllTemplates(...t)),class:"btn btn-outline",disabled:s.checkingTemplates},i(s.checkingTemplates?"ðŸ”„ Checking...":"ðŸ” Check Templates"),9,me),e("button",{onClick:o[2]||(o[2]=(...t)=>s.openSetupModal&&s.openSetupModal(...t)),class:"btn btn-outline"},"âš™ï¸ Setup Templates"),e("button",{onClick:o[3]||(o[3]=t=>s.showAddModal=!0),class:"btn btn-primary"},"+ Add Cloud Image")])]),s.templateStatus&&Object.keys(s.templateStatus).length>0?(d(),n("div",ue,[o[24]||(o[24]=e("h4",{class:"template-status-title"},"Template Status by Node",-1)),e("div",ge,[(d(!0),n(k,null,x(s.templateStatus,t=>(d(),n("div",{key:t.node_id,class:"node-status-card"},[e("div",pe,[e("span",ve,i(t.node_name),1),e("span",fe,i(s.getTemplateCount(t.templates))+" templates",1)]),e("div",be,[(d(!0),n(k,null,x(t.templates,(u,h)=>(d(),n("div",{key:h,class:"template-item"},[e("span",he,i(h),1),e("span",{class:q(["template-badge",u?"exists":"missing"])},i(u?"âœ“ Exists":"âœ— Missing"),3)]))),128))])]))),128))])])):f("",!0),s.loading?(d(),n("div",ye)):s.images.length===0?(d(),n("div",_e,[...o[25]||(o[25]=[e("p",null,"No cloud images configured yet.",-1),e("p",{class:"text-sm"},"Add cloud images for fast VM deployment.",-1)])])):(d(),n("div",we,[e("table",ke,[o[26]||(o[26]=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"OS Type"),e("th",null,"Version"),e("th",null,"Architecture"),e("th",null,"Size"),e("th",null,"Download Status"),e("th",null,"Actions")])],-1)),e("tbody",null,[(d(!0),n(k,null,x(s.images,t=>(d(),n("tr",{key:t.id},[e("td",null,i(t.name),1),e("td",null,[e("span",xe,i(s.formatOSType(t.os_type)),1)]),e("td",null,i(t.version||"N/A"),1),e("td",null,i(t.architecture),1),e("td",null,i(t.file_size?s.formatBytes(t.file_size):"Unknown"),1),e("td",null,[t.download_status==="downloading"?(d(),n("div",Ie,[e("div",Ce,[e("div",{class:"progress-bar-fill",style:$({width:t.download_progress+"%"})},null,4)]),e("span",Fe,i(t.download_progress)+"%",1)])):t.is_downloaded?(d(),n("span",Se,"Downloaded")):t.download_status==="error"?(d(),n("span",Te,"Error")):(d(),n("span",Ae,"Not Downloaded"))]),e("td",null,[e("div",Me,[!t.is_downloaded&&t.download_status!=="downloading"?(d(),n("button",{key:0,onClick:u=>s.downloadImage(t.id),class:"btn btn-primary btn-sm"}," Download ",8,Ue)):f("",!0),t.download_status==="downloading"?(d(),n("button",Le," Downloading... ")):f("",!0),e("button",{onClick:u=>s.editImage(t),class:"btn btn-outline btn-sm"},"Edit",8,Ne),e("button",{onClick:u=>s.deleteImage(t.id),class:"btn btn-danger btn-sm"},"Delete",8,De)])])]))),128))])])]))]),s.showSetupModal?(d(),n("div",{key:0,class:"modal",onClick:o[10]||(o[10]=t=>s.showSetupModal=!1)},[e("div",{class:"modal-content",onClick:o[9]||(o[9]=N(()=>{},["stop"]))},[e("div",Be,[o[27]||(o[27]=e("h3",null,"Setup Cloud Image Templates",-1)),e("button",{onClick:o[4]||(o[4]=t=>s.showSetupModal=!1),class:"btn-close"},"Ã—")]),e("div",qe,[o[33]||(o[33]=e("p",{class:"text-muted mb-2"},"Automatically create cloud image templates on a Proxmox node.",-1)),e("div",Re,[o[29]||(o[29]=e("label",{class:"form-label"},"Select Proxmox Node *",-1)),v(e("select",{"onUpdate:modelValue":o[5]||(o[5]=t=>s.setupForm.selectedNodeId=t),class:"form-control",required:""},[o[28]||(o[28]=e("option",{value:""},"Choose a node...",-1)),(d(!0),n(k,null,x(s.nodes,t=>(d(),n("option",{key:t.id,value:t.id},i(t.node_name)+" ("+i(t.proxmox_host_name)+") ",9,Ve))),128))],512),[[L,s.setupForm.selectedNodeId]])]),e("div",Oe,[o[30]||(o[30]=e("label",{class:"form-label"},"Select Cloud Images to Setup *",-1)),e("div",Ge,[(d(!0),n(k,null,x(s.images,t=>(d(),n("label",{key:t.id,class:"checkbox-item"},[v(e("input",{type:"checkbox",value:t.id,"onUpdate:modelValue":o[6]||(o[6]=u=>s.setupForm.selectedImageIds=u)},null,8,Ee),[[ee,s.setupForm.selectedImageIds]]),e("span",null,i(t.name)+" ("+i(t.os_type)+" "+i(t.version)+")",1)]))),128))]),o[31]||(o[31]=e("p",{class:"text-xs text-muted mt-1"},"Selected images will be created as templates 9000+",-1))]),s.settingUpTemplates?(d(),n("div",Pe,[...o[32]||(o[32]=[e("p",null,"Setting up templates... This may take several minutes.",-1),e("p",{class:"text-sm"},"Templates are being downloaded and configured in the background.",-1)])])):f("",!0)]),e("div",ze,[e("button",{onClick:o[7]||(o[7]=t=>s.showSetupModal=!1),class:"btn btn-outline",disabled:s.settingUpTemplates}," Cancel ",8,je),e("button",{onClick:o[8]||(o[8]=(...t)=>s.setupTemplates&&s.setupTemplates(...t)),class:"btn btn-primary",disabled:!s.setupForm.selectedNodeId||s.setupForm.selectedImageIds.length===0||s.settingUpTemplates},i(s.settingUpTemplates?"Setting Up...":"Setup Templates"),9,He)])])])):f("",!0),s.showAddModal?(d(),n("div",{key:1,class:"modal",onClick:o[22]||(o[22]=t=>s.showAddModal=!1)},[e("div",{class:"modal-content modal-large",onClick:o[21]||(o[21]=N(()=>{},["stop"]))},[e("div",Je,[e("h3",null,i(s.editingImage?"Edit":"Add")+" Cloud Image",1),e("button",{onClick:o[11]||(o[11]=(...t)=>s.closeModal&&s.closeModal(...t)),class:"btn-close"},"Ã—")]),e("form",{onSubmit:o[20]||(o[20]=N((...t)=>s.saveImage&&s.saveImage(...t),["prevent"])),class:"modal-body"},[s.editingImage?f("",!0):(d(),n("div",Ke,[o[34]||(o[34]=e("label",{class:"form-label"},"Quick Select (Popular Cloud Images)",-1)),o[35]||(o[35]=e("p",{class:"text-xs text-muted mb-2"},"Click an image below to auto-populate the form, or scroll down to enter custom details",-1)),e("div",Qe,[(d(!0),n(k,null,x(s.predefinedImages,t=>(d(),n("div",{key:t.name,onClick:u=>s.selectPredefinedImage(t),class:q(["predefined-image-card",{selected:s.imageForm.name===t.name}])},[e("div",Xe,i(t.icon),1),e("div",Ye,[e("div",Ze,i(t.name),1),e("div",$e,i(t.os_type)+" "+i(t.version),1)]),s.imageForm.name===t.name?(d(),n("div",eo,"âœ“")):f("",!0)],10,We))),128))]),o[36]||(o[36]=e("div",{class:"divider"},[e("span",null,"or enter custom cloud image details")],-1))])),e("div",oo,[o[37]||(o[37]=e("label",{class:"form-label"},"Display Name *",-1)),v(e("input",{"onUpdate:modelValue":o[12]||(o[12]=t=>s.imageForm.name=t),class:"form-control",required:"",placeholder:"Ubuntu 24.04 LTS Cloud Image"},null,512),[[C,s.imageForm.name]])]),e("div",to,[o[38]||(o[38]=e("label",{class:"form-label"},"Filename *",-1)),v(e("input",{"onUpdate:modelValue":o[13]||(o[13]=t=>s.imageForm.filename=t),class:"form-control",required:"",placeholder:"ubuntu-24.04-server-cloudimg-amd64.img"},null,512),[[C,s.imageForm.filename]]),o[39]||(o[39]=e("p",{class:"text-xs text-muted mt-1"},"The filename of the cloud image file",-1))]),e("div",so,[o[40]||(o[40]=e("label",{class:"form-label"},"Download URL *",-1)),v(e("input",{"onUpdate:modelValue":o[14]||(o[14]=t=>s.imageForm.download_url=t),class:"form-control",required:"",type:"url",placeholder:"https://cloud-images.ubuntu.com/..."},null,512),[[C,s.imageForm.download_url]]),o[41]||(o[41]=e("p",{class:"text-xs text-muted mt-1"},"Direct download URL for the cloud image",-1))]),e("div",ao,[e("div",lo,[o[43]||(o[43]=e("label",{class:"form-label"},"OS Type *",-1)),v(e("select",{"onUpdate:modelValue":o[15]||(o[15]=t=>s.imageForm.os_type=t),class:"form-control",required:""},[...o[42]||(o[42]=[oe('<option value="" data-v-d5908745>Select OS</option><option value="ubuntu" data-v-d5908745>Ubuntu</option><option value="debian" data-v-d5908745>Debian</option><option value="centos" data-v-d5908745>CentOS</option><option value="rocky" data-v-d5908745>Rocky Linux</option><option value="alma" data-v-d5908745>AlmaLinux</option><option value="fedora" data-v-d5908745>Fedora</option><option value="opensuse" data-v-d5908745>openSUSE</option><option value="other" data-v-d5908745>Other</option>',9)])],512),[[L,s.imageForm.os_type]])]),e("div",no,[o[44]||(o[44]=e("label",{class:"form-label"},"Version",-1)),v(e("input",{"onUpdate:modelValue":o[16]||(o[16]=t=>s.imageForm.version=t),class:"form-control",placeholder:"24.04"},null,512),[[C,s.imageForm.version]])])]),e("div",io,[e("div",ro,[o[46]||(o[46]=e("label",{class:"form-label"},"Architecture",-1)),v(e("select",{"onUpdate:modelValue":o[17]||(o[17]=t=>s.imageForm.architecture=t),class:"form-control"},[...o[45]||(o[45]=[e("option",{value:"amd64"},"amd64 (x86_64)",-1),e("option",{value:"arm64"},"arm64",-1)])],512),[[L,s.imageForm.architecture]])]),e("div",co,[o[47]||(o[47]=e("label",{class:"form-label"},"SHA256 Checksum",-1)),v(e("input",{"onUpdate:modelValue":o[18]||(o[18]=t=>s.imageForm.checksum=t),class:"form-control",placeholder:"Optional"},null,512),[[C,s.imageForm.checksum]])])]),e("div",mo,[e("button",{type:"button",onClick:o[19]||(o[19]=(...t)=>s.closeModal&&s.closeModal(...t)),class:"btn btn-outline"},"Cancel"),e("button",{type:"submit",disabled:s.saving,class:"btn btn-primary"},i(s.saving?"Saving...":s.editingImage?"Update":"Add"),9,uo)])],32)])])):f("",!0)])}const vo=Z(le,[["render",go],["__scopeId","data-v-d5908745"]]);export{vo as default};
