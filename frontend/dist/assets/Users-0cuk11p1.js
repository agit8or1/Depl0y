import{_ as D,c as a,o as r,a as e,d as F,F as R,p as q,t as n,m as C,w as g,e as i,v as y,A as k,b as N,E as B,x as S,r as d,k as L,l as w}from"./index-DpP9cWht.js";const T={name:"Users",setup(){const u=S(),o=d([]),v=d(!1),l=d(!1),f=d(!1),U=d(!1),s=d(!1),c=d({username:"",email:"",password:"",role:"viewer"}),m=d({id:null,username:"",email:"",role:"",is_active:!0}),b=async()=>{v.value=!0;try{const t=await w.users.list();o.value=t.data}catch(t){console.error("Failed to fetch users:",t),u.error("Failed to load users")}finally{v.value=!1}},M=async()=>{l.value=!0;try{await w.users.create(c.value),u.success("User created successfully"),U.value=!1,c.value={username:"",email:"",password:"",role:"viewer"},await b()}catch(t){console.error("Failed to create user:",t)}finally{l.value=!1}},_=t=>{m.value={id:t.id,username:t.username,email:t.email,role:t.role,is_active:t.is_active},s.value=!0},x=async()=>{f.value=!0;try{await w.users.update(m.value.id,{email:m.value.email,role:m.value.role,is_active:m.value.is_active}),u.success("User updated successfully"),s.value=!1,await b()}catch(t){console.error("Failed to update user:",t)}finally{f.value=!1}},E=async t=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{await w.users.delete(t),u.success("User deleted successfully"),await b()}catch(p){console.error("Failed to delete user:",p)}},V=t=>({admin:"Admin",operator:"Operator",viewer:"Viewer"})[t]||t,A=t=>({admin:"badge-danger",operator:"badge-warning",viewer:"badge-info"})[t]||"badge-secondary",h=t=>t?new Date(t).toLocaleString():"Never";return L(()=>{b()}),{users:o,loading:v,creating:l,updating:f,showCreateModal:U,showEditModal:s,createForm:c,editForm:m,createUser:M,editUser:_,updateUser:x,deleteUser:E,formatRole:V,getRoleBadgeClass:A,formatDate:h}}},O={class:"users-page"},I={class:"card"},z={class:"card-header"},P={key:0,class:"loading-spinner"},j={key:1,class:"text-center text-muted"},G={key:2,class:"table-container"},H={class:"table"},J={class:"text-sm"},K={class:"flex gap-1"},Q=["onClick"],W=["onClick"],X={class:"modal-content"},Y={class:"modal-header"},Z={class:"form-group"},$={class:"form-group"},ee={class:"form-group"},oe={class:"form-group"},le={class:"modal-footer"},se=["disabled"],te={class:"modal-content"},ae={class:"modal-header"},re={class:"form-group"},ne=["value"],de={class:"form-group"},ie={class:"form-group"},me={class:"form-group"},ue={class:"form-label"},ce={class:"modal-footer"},ve=["disabled"];function fe(u,o,v,l,f,U){return r(),a("div",O,[e("div",I,[e("div",z,[o[16]||(o[16]=e("h3",null,"User Management",-1)),e("button",{onClick:o[0]||(o[0]=s=>l.showCreateModal=!0),class:"btn btn-primary"},"+ Add User")]),l.loading?(r(),a("div",P)):l.users.length===0?(r(),a("div",j,[...o[17]||(o[17]=[e("p",null,"No users found.",-1)])])):(r(),a("div",G,[e("table",H,[o[18]||(o[18]=e("thead",null,[e("tr",null,[e("th",null,"Username"),e("th",null,"Email"),e("th",null,"Role"),e("th",null,"2FA"),e("th",null,"Status"),e("th",null,"Last Login"),e("th",null,"Actions")])],-1)),e("tbody",null,[(r(!0),a(R,null,q(l.users,s=>(r(),a("tr",{key:s.id},[e("td",null,[e("strong",null,n(s.username),1)]),e("td",null,n(s.email),1),e("td",null,[e("span",{class:C(["badge",l.getRoleBadgeClass(s.role)])},n(l.formatRole(s.role)),3)]),e("td",null,[e("span",{class:C(["badge",s.totp_enabled?"badge-success":"badge-secondary"])},n(s.totp_enabled?"Enabled":"Disabled"),3)]),e("td",null,[e("span",{class:C(["badge",s.is_active?"badge-success":"badge-danger"])},n(s.is_active?"Active":"Inactive"),3)]),e("td",J,n(l.formatDate(s.last_login)),1),e("td",null,[e("div",K,[e("button",{onClick:c=>l.editUser(s),class:"btn btn-outline btn-sm"}," Edit ",8,Q),e("button",{onClick:c=>l.deleteUser(s.id),class:"btn btn-danger btn-sm"}," Delete ",8,W)])])]))),128))])])]))]),l.showCreateModal?(r(),a("div",{key:0,class:"modal-overlay",onClick:o[8]||(o[8]=g(s=>l.showCreateModal=!1,["self"]))},[e("div",X,[e("div",Y,[o[19]||(o[19]=e("h3",null,"Create New User",-1)),e("button",{onClick:o[1]||(o[1]=s=>l.showCreateModal=!1),class:"modal-close"},"×")]),e("form",{onSubmit:o[7]||(o[7]=g((...s)=>l.createUser&&l.createUser(...s),["prevent"])),class:"modal-body"},[e("div",Z,[o[20]||(o[20]=e("label",{for:"username",class:"form-label"},"Username *",-1)),i(e("input",{"onUpdate:modelValue":o[2]||(o[2]=s=>l.createForm.username=s),type:"text",id:"username",class:"form-control",required:""},null,512),[[y,l.createForm.username]])]),e("div",$,[o[21]||(o[21]=e("label",{for:"email",class:"form-label"},"Email *",-1)),i(e("input",{"onUpdate:modelValue":o[3]||(o[3]=s=>l.createForm.email=s),type:"email",id:"email",class:"form-control",required:""},null,512),[[y,l.createForm.email]])]),e("div",ee,[o[22]||(o[22]=e("label",{for:"password",class:"form-label"},"Password *",-1)),i(e("input",{"onUpdate:modelValue":o[4]||(o[4]=s=>l.createForm.password=s),type:"password",id:"password",class:"form-control",required:"",minlength:"8"},null,512),[[y,l.createForm.password]])]),e("div",oe,[o[24]||(o[24]=e("label",{for:"role",class:"form-label"},"Role *",-1)),i(e("select",{"onUpdate:modelValue":o[5]||(o[5]=s=>l.createForm.role=s),id:"role",class:"form-control",required:""},[...o[23]||(o[23]=[e("option",{value:"admin"},"Admin",-1),e("option",{value:"operator"},"Operator",-1),e("option",{value:"viewer"},"Viewer",-1)])],512),[[k,l.createForm.role]])]),e("div",le,[e("button",{type:"button",onClick:o[6]||(o[6]=s=>l.showCreateModal=!1),class:"btn btn-outline"}," Cancel "),e("button",{type:"submit",class:"btn btn-primary",disabled:l.creating},n(l.creating?"Creating...":"Create User"),9,se)])],32)])])):F("",!0),l.showEditModal?(r(),a("div",{key:1,class:"modal-overlay",onClick:o[15]||(o[15]=g(s=>l.showEditModal=!1,["self"]))},[e("div",te,[e("div",ae,[o[25]||(o[25]=e("h3",null,"Edit User",-1)),e("button",{onClick:o[9]||(o[9]=s=>l.showEditModal=!1),class:"modal-close"},"×")]),e("form",{onSubmit:o[14]||(o[14]=g((...s)=>l.updateUser&&l.updateUser(...s),["prevent"])),class:"modal-body"},[e("div",re,[o[26]||(o[26]=e("label",{class:"form-label"},"Username",-1)),e("input",{value:l.editForm.username,type:"text",class:"form-control",disabled:""},null,8,ne)]),e("div",de,[o[27]||(o[27]=e("label",{for:"edit-email",class:"form-label"},"Email *",-1)),i(e("input",{"onUpdate:modelValue":o[10]||(o[10]=s=>l.editForm.email=s),type:"email",id:"edit-email",class:"form-control",required:""},null,512),[[y,l.editForm.email]])]),e("div",ie,[o[29]||(o[29]=e("label",{for:"edit-role",class:"form-label"},"Role *",-1)),i(e("select",{"onUpdate:modelValue":o[11]||(o[11]=s=>l.editForm.role=s),id:"edit-role",class:"form-control",required:""},[...o[28]||(o[28]=[e("option",{value:"admin"},"Admin",-1),e("option",{value:"operator"},"Operator",-1),e("option",{value:"viewer"},"Viewer",-1)])],512),[[k,l.editForm.role]])]),e("div",me,[e("label",ue,[i(e("input",{"onUpdate:modelValue":o[12]||(o[12]=s=>l.editForm.is_active=s),type:"checkbox"},null,512),[[B,l.editForm.is_active]]),o[30]||(o[30]=N(" Active ",-1))])]),e("div",ce,[e("button",{type:"button",onClick:o[13]||(o[13]=s=>l.showEditModal=!1),class:"btn btn-outline"}," Cancel "),e("button",{type:"submit",class:"btn btn-primary",disabled:l.updating},n(l.updating?"Updating...":"Update User"),9,ve)])],32)])])):F("",!0)])}const pe=D(T,[["render",fe],["__scopeId","data-v-ddf646d5"]]);export{pe as default};
